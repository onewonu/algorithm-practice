name: Move LeetCode Files

on:
  push:
    branches: [ main, master ]

jobs:
  move-files:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Move LeetCode problem directories
      id: move-files
      run: |
        # leetcode ë””ë ‰í† ë¦¬ ìƒì„±
        mkdir -p leetcode
        
        moved=false
        
        # ê¸°ì¡´ í”„ë¡œì íŠ¸ ë””ë ‰í„°ë¦¬ ëª©ë¡ (ì´ë™í•˜ì§€ ì•Šì„ ë””ë ‰í„°ë¦¬ë“¤)
        EXCLUDE_DIRS=("leetcode" "basic" "README.md" ".git" ".github" "node_modules" "target" "build" "src" "docs" "test" "tests")
        
        # ë£¨íŠ¸ì˜ ë””ë ‰í„°ë¦¬ë“¤ í™•ì¸
        for dir in */; do
          dirname=$(basename "$dir")
          
          # ì œì™¸ ëª©ë¡ì— ìžˆëŠ”ì§€ í™•ì¸
          exclude=false
          for exclude_dir in "${EXCLUDE_DIRS[@]}"; do
            if [[ "$dirname" == "$exclude_dir" ]]; then
              exclude=true
              break
            fi
          done
          
          # ì œì™¸ ëª©ë¡ì— ì—†ê³ , LeetCode íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ë§Œ ì´ë™
          if [[ "$exclude" == false ]]; then
            # LeetCode ë””ë ‰í„°ë¦¬ íŒ¨í„´ í™•ì¸
            # 1. ìˆ«ìžë¡œ ì‹œìž‘í•˜ëŠ” ë””ë ‰í„°ë¦¬ (ì˜ˆ: 1-two-sum, 2-add-two-numbers)
            # 2. ë˜ëŠ” leetcode ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ë””ë ‰í„°ë¦¬
            if [[ "$dirname" =~ ^[0-9]+- ]] || [[ "$dirname" =~ ^[0-9]{4}- ]] || [[ "$dirname" =~ leetcode|problem ]]; then
              echo "Moving LeetCode problem directory: $dir â†’ leetcode/"
              mv "$dir" "leetcode/"
              moved=true
            else
              echo "Skipping directory (not LeetCode pattern): $dirname"
            fi
          else
            echo "Skipping excluded directory: $dirname"
          fi
        done
        
        # ë£¨íŠ¸ì— ê°œë³„ íŒŒì¼ì´ ìžˆëŠ” ê²½ìš°ë„ ì²˜ë¦¬ (LeetCode ê´€ë ¨ë§Œ)
        for file in *.py *.java *.js *.cpp *.c; do
          if [[ -f "$file" ]]; then
            # íŒŒì¼ëª…ì´ LeetCode íŒ¨í„´ì¸ì§€ í™•ì¸ (ìˆ«ìžë¡œ ì‹œìž‘í•˜ê±°ë‚˜ leetcode í‚¤ì›Œë“œ í¬í•¨)
            if [[ "$file" =~ ^[0-9]+- ]] || [[ "$file" =~ leetcode|problem ]]; then
              echo "Moving LeetCode file: $file â†’ leetcode/"
              mv "$file" "leetcode/"
              moved=true
            else
              echo "Skipping file (not LeetCode pattern): $file"
            fi
          fi
        done
        
        # README.mdëŠ” LeetHubì´ ìƒì„±í•œ ê²ƒë§Œ ì´ë™ (ìµœê·¼ì— ìˆ˜ì •ëœ ê²ƒìœ¼ë¡œ íŒë‹¨)
        if [[ -f "README.md" ]]; then
          # íŒŒì¼ì´ ìµœê·¼ 1ë¶„ ë‚´ì— ìˆ˜ì •ëœ ê²½ìš°ë§Œ LeetHubì´ ìƒì„±í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼
          if [[ $(find "README.md" -mmin -1) ]]; then
            if [[ ! -f "leetcode/LeetCode-README.md" ]]; then
              echo "Moving LeetHub README.md â†’ leetcode/LeetCode-README.md"
              mv "README.md" "leetcode/LeetCode-README.md"
              moved=true
            fi
          fi
        fi
        
        echo "moved=$moved" >> $GITHUB_OUTPUT
        
    - name: Show final structure
      run: |
        echo "=== Root directory (should keep basic/ and other project folders) ==="
        ls -la
        echo "=== LeetCode directory contents ==="
        ls -la leetcode/ 2>/dev/null || echo "leetcode directory is empty"
        
    - name: Commit and push changes
      if: steps.move-files.outputs.moved == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git commit -m "ðŸš€ Auto-moved LeetCode problem directories to leetcode/"
        git push
